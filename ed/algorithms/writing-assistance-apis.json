{
  "spec": {
    "title": "Writing Assistance APIs",
    "url": "https://webmachinelearning.github.io/writing-assistance-apis/"
  },
  "algorithms": [
    {
      "name": "AICapabilityAvailability/minimum availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#aicapabilityavailability-minimum-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"AICapabilityAvailability\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"aicapabilityavailability-minimum-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">minimum availability</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aicapabilityavailability\" id=\"ref-for-enumdef-aicapabilityavailability\">AICapabilityAvailability</a></code>-or-null values <var>availabilities</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> null, then return null.</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-no\" id=\"ref-for-dom-aicapabilityavailability-no\">no</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-no\" id=\"ref-for-dom-aicapabilityavailability-no①\">no</a></code>\".</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download\">after-download</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download①\">after-download</a></code>\".</p>"
        },
        {
          "html": "<p>Return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-readily\" id=\"ref-for-dom-aicapabilityavailability-readily\">readily</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "AISummarizerFactory/create(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizerfactory-create",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizerFactory\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"create(options)|create()\" id=\"dom-aisummarizerfactory-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>create(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①\">a promise rejected with</a> <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal①\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags\">Validate and canonicalize language tags</a> given <var>options</var>. If this throws an exception <var>e</var>, catch it, and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②\">a promise rejected with</a> <var>e</var>.</p>"
        },
        {
          "html": "<p>Let <var>fireProgressEvent</var> be an algorithm taking two arguments that does nothing.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-monitor\" id=\"ref-for-dom-aisummarizercreateoptions-monitor\">monitor</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>monitor</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aicreatemonitor\" id=\"ref-for-aicreatemonitor②\">AICreateMonitor</a></code> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">Invoke</a> <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-monitor\" id=\"ref-for-dom-aisummarizercreateoptions-monitor①\">monitor</a></code>\"] with « <var>monitor</var> » and \"<code>rethrow</code>\".</p>\n        <p>If this throws an exception <var>e</var>, catch it, and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with③\">a promise rejected with</a> <var>e</var>.</p>"
            },
            {
              "html": "Set <var>fireProgressEvent</var> to an algorithm taking arguments <var>loaded</var> and <var>total</var>, which performs the following steps:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a> to perform the following steps:",
                  "rationale": "fire",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#eventdef-aicreatemonitor-downloadprogress\" id=\"ref-for-eventdef-aicreatemonitor-downloadprogress\">downloadprogress</a></code> at <var>monitor</var>, using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#progressevent\" id=\"ref-for-progressevent\">ProgressEvent</a></code>, with the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-loaded\" id=\"ref-for-dom-progressevent-loaded\">loaded</a></code> attribute initialized to <var>loaded</var>, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-total\" id=\"ref-for-dom-progressevent-total\">total</a></code> attribute initialized to <var>total</var>, and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-lengthcomputable\" id=\"ref-for-dom-progressevent-lengthcomputable\">lengthComputable</a></code> attribute initialized to true.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>abortedDuringDownload</var> be false.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal②\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">add the following abort steps</a> to <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal③\">signal</a></code>\"]:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringDownload</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>availability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability\" id=\"ref-for-compute-summarizer-options-availability\">computing summarizer options availability</a> given <var>options</var>.</p>"
            },
            {
              "html": "<p>Switch on <var>availability</var>:</p>"
            }
          ],
          "additional": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">In parallel</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "null",
                      "html": "",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">Reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror\">UnknownError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"no\"",
                      "html": "",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">Reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"readily\"",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarization-model\" id=\"ref-for-initialize-the-summarization-model\">initializing the summarization model</a> given <var>promise</var> and <var>options</var> returns false, then abort these steps.</p>"
                        },
                        {
                          "html": "<p>Let <var>totalBytes</var> be the total size of the previously-downloaded summarization capabilities, in bytes.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>totalBytes</var> is greater than 0.</p>"
                        },
                        {
                          "html": "<p>Perform <var>fireProgressEvent</var> given 0 and <var>totalBytes</var>.</p>"
                        },
                        {
                          "html": "<p>Perform <var>fireProgressEvent</var> given <var>totalBytes</var> and <var>totalBytes</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#finalize-summarizer-creation\" id=\"ref-for-finalize-summarizer-creation\">Finalize summarizer creation</a> given <var>promise</var> and <var>options</var>.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"after-download\"",
                      "html": "",
                      "rationale": "run",
                      "steps": [
                        {
                          "html": "<p>Initiate the download process for everything the user agent needs to summarize text according to <var>options</var>.</p>"
                        },
                        {
                          "html": "Run the following steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <var>abortedDuringDownload</var> becomes true:",
                          "rationale": "wait",
                          "steps": [
                            {
                              "html": "<p>Wait for the total number of bytes to be downloaded to become determined, and let that number be <var>totalBytes</var>.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock\">monotonic clock</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time\">unsafe current time</a>.</p>"
                            },
                            {
                              "html": "<p>Perform <var>fireProgressEvent</var> given 0 and <var>totalBytes</var>.</p>"
                            },
                            {
                              "html": "While true:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If one or more bytes have been downloaded, then:",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock①\">monotonic clock</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time①\">unsafe current time</a> minus <var>lastProgressTime</var> is greater than 50 ms, then:",
                                      "rationale": "let",
                                      "steps": [
                                        {
                                          "html": "<p>Let <var>bytesSoFar</var> be the number of bytes downloaded so far.</p>"
                                        },
                                        {
                                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>bytesSoFar</var> is greater than 0 and less than or equal to <var>totalBytes</var>.</p>"
                                        },
                                        {
                                          "html": "<p>Perform <var>fireProgressEvent</var> given <var>bytesSoFar</var> and <var>totalBytes</var>.</p>"
                                        },
                                        {
                                          "html": "<p>If <var>bytesSoFar</var> equals <var>totalBytes</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">break</a>.</p>"
                                        },
                                        {
                                          "html": "<p>Set <var>lastProgressTime</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock②\">monotonic clock</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time②\">unsafe current time</a>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "html": "Otherwise, if downloading has failed and cannot continue, then:",
                                  "rationale": "queue",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
                                    },
                                    {
                                      "html": "<p>Abort these steps.</p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source②\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a> to perform the following steps:",
                              "rationale": "assert",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal④\">signal</a></code>\"]'s is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted①\">aborted</a>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">Reject</a> <var>promise</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal⑤\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarization-model\" id=\"ref-for-initialize-the-summarization-model①\">initializing the summarization model</a> given <var>promise</var> and <var>options</var> returns false, then abort these steps.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#finalize-summarizer-creation\" id=\"ref-for-finalize-summarizer-creation①\">Finalize summarizer creation</a> given <var>promise</var> and <var>options</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "initialize the summarization model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarization-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-summarization-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the summarization model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise③\">Promise</a></code> <var>promise</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreateoptions\" id=\"ref-for-dictdef-aisummarizercreateoptions①\">AISummarizerCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform any necessary initialization operations for the AI model backing the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent\">user agent</a>'s summarization capabilities.</p>\n      <p>This could include loading the model into memory, loading <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-sharedcontext\" id=\"ref-for-dom-aisummarizercreateoptions-sharedcontext\">sharedContext</a></code>\"] into the model’s context window, or loading any fine-tunings necessary to support the other options expressed by <var>options</var>.</p>"
        },
        {
          "html": "If initialization failed for any reason, then:",
          "rationale": "queue",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source③\">AI task source</a> given <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror\">OperationError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "finalize summarizer creation",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#finalize-summarizer-creation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"finalize-summarizer-creation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">finalize summarizer creation</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise④\">Promise</a></code> <var>promise</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreateoptions\" id=\"ref-for-dictdef-aisummarizercreateoptions②\">AISummarizerCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source④\">AI task source</a> given <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a> to perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal⑥\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted②\">aborted</a>, then:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">Reject</a> <var>promise</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal⑦\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason②\">abort reason</a>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>summarizer</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer\" id=\"ref-for-aisummarizer①\">AISummarizer</a></code> object, created in <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a>, with</p>\n        <dl class=\"props\">\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context\">shared context</a>\n         </dt><dd data-md=\"\">\n          <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-sharedcontext\" id=\"ref-for-dom-aisummarizercreateoptions-sharedcontext①\">sharedContext</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exists</a>; otherwise null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type\">summary type</a>\n         </dt><dd data-md=\"\">\n          <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-type\" id=\"ref-for-dom-aisummarizercreatecoreoptions-type\">type</a></code>\"]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format\">summary format</a>\n         </dt><dd data-md=\"\">\n          <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-format\" id=\"ref-for-dom-aisummarizercreatecoreoptions-format\">format</a></code>\"]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length\">summary length</a>\n         </dt><dd data-md=\"\">\n          <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-length\" id=\"ref-for-dom-aisummarizercreatecoreoptions-length\">length</a></code>\"]</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-expected-input-languages\" id=\"ref-for-aisummarizer-expected-input-languages\">expected input languages</a>\n         </dt><dd data-md=\"\">\n          <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages\">expectedInputLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is not empty</a>; otherwise null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-expected-context-languages\" id=\"ref-for-aisummarizer-expected-context-languages\">expected context languages</a>\n         </dt><dd data-md=\"\">\n          <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array①\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages\">expectedContextLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①\">is not empty</a>; otherwise null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language\">output language</a>\n         </dt><dd data-md=\"\">\n          <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage\">outputLanguage</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a>; otherwise null</p>\n        </dd></dl>"
            },
            {
              "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal⑧\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add①\">add the following abort steps</a> to <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal⑨\">signal</a></code>\"]:",
              "rationale": "destroy",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroy\" id=\"ref-for-aisummarizer-destroy\">Destroy</a> <var>summarizer</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal①⓪\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason③\">abort reason</a>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>promise</var> with <var>summarizer</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "validate and canonicalize language tags",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-canonicalize-language-tags\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize language tags</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreatecoreoptions\" id=\"ref-for-dictdef-aisummarizercreatecoreoptions②\">AISummarizerCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags, and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>expectedInputLanguages</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">ordered set</a>.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages①\">expectedInputLanguages</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">for each</a> <var>languageTag</var> of <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages②\">expectedInputLanguages</a></code>\"]:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag\">IsStructurallyValidLanguageTag</a>(<var>languageTag</var>) is false, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-canonicalizeunicodelocaleid\" id=\"ref-for-sec-canonicalizeunicodelocaleid\">CanonicalizeUnicodeLocaleId</a>(<var>languageTag</var>) to <var>expectedInputLanguages</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages③\">expectedInputLanguages</a></code>\"] to <var>expectedInputLanguages</var>.</p>"
        },
        {
          "html": "<p>Let <var>expectedContextLanguages</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">ordered set</a>.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages①\">expectedContextLanguages</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">for each</a> <var>languageTag</var> of <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages②\">expectedContextLanguages</a></code>\"]:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag①\">IsStructurallyValidLanguageTag</a>(<var>languageTag</var>) is false, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-canonicalizeunicodelocaleid\" id=\"ref-for-sec-canonicalizeunicodelocaleid①\">CanonicalizeUnicodeLocaleId</a>(<var>languageTag</var>) to <var>expectedContextLanguages</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages③\">expectedContextLanguages</a></code>\"] to <var>expectedContextLanguages</var>.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage①\">outputLanguage</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exists</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag②\">IsStructurallyValidLanguageTag</a>(<var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage②\">outputLanguage</a></code>\"]) is false, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage③\">outputLanguage</a></code>\"] to <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-canonicalizeunicodelocaleid\" id=\"ref-for-sec-canonicalizeunicodelocaleid②\">CanonicalizeUnicodeLocaleId</a>(<var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage④\">outputLanguage</a></code>\"]).</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "AISummarizerFactory/available(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizerfactory-available",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizerFactory\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"available(options)|available()\" id=\"dom-aisummarizerfactory-available\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>available(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active①\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with④\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags①\">Validate and canonicalize language tags</a> given <var>options</var>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>availability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability\" id=\"ref-for-compute-summarizer-options-availability①\">computing summarizer options availability</a> given <var>options</var>.</p>"
            },
            {
              "html": "<p>If <var>availability</var> is null, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror①\">UnknownError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>promise</var> with <var>availability</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "compute summarizer options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-summarizer-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute summarizer options availability</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreatecoreoptions\" id=\"ref-for-dictdef-aisummarizercreatecoreoptions③\">AISummarizerCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They return either an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aicapabilityavailability\" id=\"ref-for-enumdef-aicapabilityavailability②\">AICapabilityAvailability</a></code> value or null, and they mutate <var>options</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>availability</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability\" id=\"ref-for-summarizer-non-language-options-availability\">summarizer non-language options availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-type\" id=\"ref-for-dom-aisummarizercreatecoreoptions-type①\">type</a></code>\"], <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-format\" id=\"ref-for-dom-aisummarizercreatecoreoptions-format①\">format</a></code>\"], and <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-length\" id=\"ref-for-dom-aisummarizercreatecoreoptions-length①\">length</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>availability</var> is null, then return null.</p>"
        },
        {
          "html": "<p>Let <var>languageAvailabilities</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities\" id=\"ref-for-summarizer-language-availabilities\">summarizer language availabilities</a>.</p>"
        },
        {
          "html": "<p>If <var>languageAvailabilities</var> is null, then return null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>languageTag</var> of <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages④\">expectedInputLanguages</a></code>\"]:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bestReadilyAvailableMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit\">LookupMatchingLocaleByBestFit</a>(<var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-readily-available-input-languages\" id=\"ref-for-language-availabilities-readily-available-input-languages\">readily available input languages</a>, <var>languageTag</var>).</p>"
            },
            {
              "html": "If <var>bestReadilyAvailableMatch</var> is not undefined, then:",
              "rationale": "replace",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace\">Replace</a> <var>languageTag</var> with <var>bestReadilyAvailableMatch</var> in <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages⑤\">expectedInputLanguages</a></code>\"].</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">Continue</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>bestAfterDownloadAvailableMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit①\">LookupMatchingLocaleByBestFit</a>(<var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-after-download-available-input-languages\" id=\"ref-for-language-availabilities-after-download-available-input-languages\">after-download available input languages</a>, <var>languageTag</var>).</p>"
            },
            {
              "html": "If <var>bestAfterDownloadAvailableMatch</var> is not undefined, then:",
              "rationale": "replace",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace①\">Replace</a> <var>languageTag</var> with <var>bestAfterDownloadAvailableMatch</var> in <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages⑥\">expectedInputLanguages</a></code>\"].</p>"
                },
                {
                  "html": "<p>Set <var>availability</var> to the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aicapabilityavailability-minimum-availability\" id=\"ref-for-aicapabilityavailability-minimum-availability\">minimum availability</a> given « <var>availability</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download③\">after-download</a></code>\" ».</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-no\" id=\"ref-for-dom-aicapabilityavailability-no③\">no</a></code>\".</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>languageTag</var> of <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages④\">expectedContextLanguages</a></code>\"]:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bestReadilyAvailableMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit②\">LookupMatchingLocaleByBestFit</a>(<var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-readily-available-context-languages\" id=\"ref-for-language-availabilities-readily-available-context-languages\">readily available context languages</a>, <var>languageTag</var>).</p>"
            },
            {
              "html": "If <var>bestReadilyAvailableMatch</var> is not undefined, then:",
              "rationale": "replace",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace②\">Replace</a> <var>languageTag</var> with <var>bestReadilyAvailableMatch</var> in <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages⑤\">expectedContextLanguages</a></code>\"].</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">Continue</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>bestAfterDownloadAvailableMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit③\">LookupMatchingLocaleByBestFit</a>(<var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-after-download-available-context-languages\" id=\"ref-for-language-availabilities-after-download-available-context-languages\">after-download available context languages</a>, <var>languageTag</var>).</p>"
            },
            {
              "html": "If <var>bestAfterDownloadAvailableMatch</var> is not undefined, then:",
              "rationale": "replace",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace③\">Replace</a> <var>languageTag</var> with <var>bestAfterDownloadAvailableMatch</var> in <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages⑥\">expectedContextLanguages</a></code>\"].</p>"
                },
                {
                  "html": "<p>Set <var>availability</var> to the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aicapabilityavailability-minimum-availability\" id=\"ref-for-aicapabilityavailability-minimum-availability①\">minimum availability</a> given « <var>availability</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download④\">after-download</a></code>\" ».</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-no\" id=\"ref-for-dom-aicapabilityavailability-no④\">no</a></code>\".</p>"
            }
          ]
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage⑤\">outputLanguage</a></code>\"] is present, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bestReadilyAvailableMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit④\">LookupMatchingLocaleByBestFit</a>(<var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-readily-available-output-languages\" id=\"ref-for-language-availabilities-readily-available-output-languages\">readily available output languages</a>, <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage⑥\">outputLanguage</a></code>\"]).</p>"
            },
            {
              "html": "If <var>bestReadilyAvailableMatch</var> is not undefined, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage⑦\">outputLanguage</a></code>\"] to <var>bestReadilyAvailableMatch</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>bestAfterDownloadAvailableMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit⑤\">LookupMatchingLocaleByBestFit</a>(<var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-after-download-available-output-languages\" id=\"ref-for-language-availabilities-after-download-available-output-languages\">after-download available output languages</a>, <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage⑧\">outputLanguage</a></code>\"]).</p>"
                },
                {
                  "html": "If <var>bestAfterDownloadAvailableMatch</var> is not undefined, then:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage⑨\">outputLanguage</a></code>\"] to <var>bestAfterDownloadAvailableMatch</var>.</p>"
                    },
                    {
                      "html": "<p>Set <var>availability</var> to the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aicapabilityavailability-minimum-availability\" id=\"ref-for-aicapabilityavailability-minimum-availability②\">minimum availability</a> given « <var>availability</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download⑤\">after-download</a></code>\" ».</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-no\" id=\"ref-for-dom-aicapabilityavailability-no⑤\">no</a></code>\".</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: <var>availability</var> is either \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-readily\" id=\"ref-for-dom-aicapabilityavailability-readily②\">readily</a></code>\" or \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download⑥\">after-download</a></code>\".</p>"
        },
        {
          "html": "<p>Return <var>availability</var>.</p>"
        }
      ]
    },
    {
      "name": "summarizer non-language options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarizer-non-language-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarizer non-language options availability</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype②\">AISummarizerType</a></code> <var>type</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerformat\" id=\"ref-for-enumdef-aisummarizerformat②\">AISummarizerFormat</a></code> <var>format</var>, and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerlength\" id=\"ref-for-enumdef-aisummarizerlength②\">AISummarizerLength</a></code> <var>length</var>, is given by the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aicapabilityavailability\" id=\"ref-for-enumdef-aicapabilityavailability③\">AICapabilityAvailability</a></code> value or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports summarizing text, which the user agent believes to be transient (such that re-querying the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability\" id=\"ref-for-summarizer-non-language-options-availability①\">summarizer non-language options availability</a> could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>If the user agent supports summarizing text into the type of summary described by <var>type</var>, in the format described by <var>format</var>, and with the length guidance given by <var>length</var> without performing any downloading operations, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-readily\" id=\"ref-for-dom-aicapabilityavailability-readily③\">readily</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can summarize text according to <var>type</var>, <var>format</var>, and <var>length</var>, but only after performing a download (e.g., of an AI model or fine-tuning), then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-after-download\" id=\"ref-for-dom-aicapabilityavailability-after-download⑦\">after-download</a></code>\".</p>"
        },
        {
          "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aicapabilityavailability-no\" id=\"ref-for-dom-aicapabilityavailability-no⑥\">no</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "summarizer language availabilities",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarizer-language-availabilities\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarizer language availabilities</dfn> are given by the following steps. They return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities\" id=\"ref-for-language-availabilities\">language availabilities</a> or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports summarizing text, which the user agent believes to be transient (such that re-querying the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities\" id=\"ref-for-summarizer-language-availabilities①\">summarizer language availabilities</a> could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>Let <var>availabilities</var> be a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities\" id=\"ref-for-language-availabilities①\">language availabilities</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#fill-language-availabilities\" id=\"ref-for-fill-language-availabilities\">Fill language availabilities</a> given <var>availabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-readily-available-input-languages\" id=\"ref-for-language-availabilities-readily-available-input-languages①\">readily available input languages</a>, <var>availabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-after-download-available-input-languages\" id=\"ref-for-language-availabilities-after-download-available-input-languages①\">after-download available input languages</a>, and the purpose of summarizing text written in that language.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#fill-language-availabilities\" id=\"ref-for-fill-language-availabilities①\">Fill language availabilities</a> given <var>availabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-readily-available-context-languages\" id=\"ref-for-language-availabilities-readily-available-context-languages①\">readily available context languages</a>, <var>availabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-after-download-available-context-languages\" id=\"ref-for-language-availabilities-after-download-available-context-languages①\">after-download available context languages</a>, and the purpose of summarizing text using web-developer provided context information written in that language.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#fill-language-availabilities\" id=\"ref-for-fill-language-availabilities②\">Fill language availabilities</a> given <var>availabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-readily-available-output-languages\" id=\"ref-for-language-availabilities-readily-available-output-languages①\">readily available output languages</a>, <var>availabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-after-download-available-output-languages\" id=\"ref-for-language-availabilities-after-download-available-output-languages①\">after-download available output languages</a>, and the purpose of producing text summaries in that language.</p>"
        },
        {
          "html": "<p>Return <var>availabilities</var>.</p>"
        }
      ]
    },
    {
      "name": "fill language availabilities",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#fill-language-availabilities",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fill-language-availabilities\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fill language availabilities</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a> <var>readilyAvailableLanguages</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">set</a> <var>afterDownloadAvailableLanguages</var>, and a description of the purpose for which we’re checking language availability, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags①\">Unicode canonicalized locale identifier</a>, for which the user agent supports <var>purpose</var>, without performing any downloading operations:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">Append</a> <var>languageTag</var> to <var>readilyAvailableLanguages</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags②\">Unicode canonicalized locale identifier</a>, for which the user agent believes it can support <var>purpose</var>, but only after performing a download (e.g., of an AI model or fine-tuning):",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a>: <var>readilyAvailableLanguages</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contain</a> <var>languageTag</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">Append</a> <var>languageTag</var> to <var>afterDownloadAvailableLanguages</var>.</p>"
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union\">union</a> of <var>readilyAvailableLanguages</var> and <var>afterDownloadAvailableLanguages</var> does not meet the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-tag-set-completeness-rules\" id=\"ref-for-language-tag-set-completeness-rules\">language tag set completeness rules</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>missingLanguageTags</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤\">set</a> of missing language tags necessary to meet the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-tag-set-completeness-rules\" id=\"ref-for-language-tag-set-completeness-rules①\">language tag set completeness rules</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>languageTag</var> of <var>missingLanguageTags</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><span id=\"readily-or-after-download-implementation-defined\"></span> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">Append</a> <var>languageTag</var> to either <var>readilyAvailableLanguages</var> or <var>afterDownloadAvailableLanguages</var>. Which of the two sets to append to is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a>, and should be guided by considerations similar to that of <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit⑥\">LookupMatchingLocaleByBestFit</a> in terms of keeping \"best fallback languages\" together.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "AISummarizer/summarize(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizer-summarize",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"summarize(input, options)|summarize(input)\" id=\"dom-aisummarizer-summarize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>summarize(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window②\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active②\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑤\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed\">destroyed</a> is true, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑥\">a promise rejected with</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason①\">destruction reason</a>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted④\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑦\">a promise rejected with</a> <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal①\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason④\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringSummarization</var> be false.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal②\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add②\">add the following abort steps</a> to <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal③\">signal</a></code>\"]:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringSummarization</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-context\" id=\"ref-for-dom-aisummarizersummarizeoptions-context\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①①\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>summary</var> be the empty string.</p>"
            },
            {
              "html": "Let <var>chunkProduced</var> be the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②\">string</a> <var>chunk</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑤\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>abortedDuringSummarization</var> is true, then:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">Reject</a> <var>promise</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal④\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑤\">abort reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed①\">destroyed</a> is true, then:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">Reject</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason②\">destruction reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Append <var>chunk</var> to <var>summary</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>done</var> be the following steps:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑥\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>abortedDuringSummarization</var> is true, then:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">Reject</a> <var>promise</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal⑤\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑥\">abort reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed②\">destroyed</a> is true, then:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⓪\">Reject</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason③\">destruction reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>promise</var> with <var>summary</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>error</var> be the following steps given <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information\" id=\"ref-for-summarization-error-information\">summarization error information</a> <var>errorInfo</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑦\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>abortedDuringSummarization</var> is true, then:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①①\">Reject</a> <var>promise</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal⑥\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑦\">abort reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Let <var>exception</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-exception\" id=\"ref-for-dfn-create-exception\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code> with name given by <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information-error-name\" id=\"ref-for-summarization-error-information-error-name\">error name</a>, using <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information-error-information\" id=\"ref-for-summarization-error-information-error-information\">error information</a> to populate the message appropriately.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①②\">Reject</a> <var>promise</var> with <var>exception</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>stopProducing</var> be the following steps:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>abortedDuringSummarization</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize\">Summarize</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context②\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type②\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format②\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length②\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language②\">output language</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "AISummarizer/summarizeStreaming(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizer-summarizestreaming",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"summarizeStreaming(input, options)|summarizeStreaming(input)\" id=\"dom-aisummarizer-summarizestreaming\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>summarizeStreaming(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window③\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active③\">fully active</a>, then throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed③\">destroyed</a> is true, then throw <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason④\">destruction reason</a>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal⑦\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted⑤\">aborted</a>, then throw <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal⑧\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑧\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringSummarization</var> be false.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal①⓪\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add③\">add the following abort steps</a> to <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal①①\">signal</a></code>\"]:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringSummarization</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>stream</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream①\">ReadableStream</a></code> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>canceledDuringSummarization</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\" id=\"ref-for-readablestream-set-up\">Set up</a> <var>stream</var> with <i><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\" id=\"ref-for-readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a></i> set to the following steps (ignoring the <var>reason</var> argument):",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>canceledDuringSummarization</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-context\" id=\"ref-for-dom-aisummarizersummarizeoptions-context①\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①④\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>chunkProduced</var> be the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③\">string</a> <var>chunk</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑧\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑧\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>abortedDuringSummarization</var> is true, then:",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error\">Error</a> <var>stream</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal①②\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑨\">abort reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed④\">destroyed</a> is true, then:",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error①\">Error</a> <var>stream</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason⑤\">destruction reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue\">Enqueue</a> <var>chunk</var> into <var>stream</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>done</var> be the following steps:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑨\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑨\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>abortedDuringSummarization</var> is true, then:",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error②\">Error</a> <var>stream</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal①③\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①⓪\">abort reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed⑤\">destroyed</a> is true, then:",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error③\">Error</a> <var>stream</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason⑥\">destruction reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\" id=\"ref-for-readablestream-close\">Close</a> <var>stream</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>error</var> be the following steps given <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information\" id=\"ref-for-summarization-error-information①\">summarization error information</a> <var>errorInfo</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⓪\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①⓪\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①④\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>abortedDuringSummarization</var> is true, then:",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error④\">Error</a> <var>stream</var> with <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal①④\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①①\">abort reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed⑥\">destroyed</a> is true, then:",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error⑤\">Error</a> <var>stream</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason⑦\">destruction reason</a>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Let <var>exception</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-exception\" id=\"ref-for-dfn-create-exception①\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code> with name given by <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information-error-name\" id=\"ref-for-summarization-error-information-error-name①\">error name</a>, using <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information-error-information\" id=\"ref-for-summarization-error-information-error-information①\">error information</a> to populate the message appropriately.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error⑥\">Error</a> <var>stream</var> with <var>exception</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>stopProducing</var> be the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If any of <var>abortedDuringSummarization</var>, <var>canceledDuringSummarization</var>, or <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed⑦\">destroyed</a> are true, then return true.</p>"
                },
                {
                  "html": "<p>Return false.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize①\">Summarize</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context③\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type③\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format③\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length③\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language③\">output language</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>stream</var>.</p>"
        }
      ]
    },
    {
      "name": "summarize",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarize",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarize</dfn> a string <var>input</var>, given a string-or-null <var>sharedContext</var>, a string-or-null <var>context</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype④\">AISummarizerType</a></code> <var>type</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerformat\" id=\"ref-for-enumdef-aisummarizerformat④\">AISummarizerFormat</a></code> <var>format</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerlength\" id=\"ref-for-enumdef-aisummarizerlength④\">AISummarizerLength</a></code> <var>length</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④\">string</a>-or-null <var>outputLanguage</var>, an algorithm <var>chunkProduced</var> that takes a string and returns nothing, an algorithm <var>done</var> that takes no arguments and returns nothing, an algorithm <var>error</var> that takes <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information\" id=\"ref-for-summarization-error-information②\">summarization error information</a> and returns nothing, and an algorithm <var>stopProducing</var> that takes no arguments and returns a boolean:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑤\">in parallel</a>.</p>"
        },
        {
          "html": "<p>In an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①\">implementation-defined</a> manner, subject to the following guidelines, begin the processs of summarizing <var>input</var> into a string.</p>\n      <p>If they are non-null, <var>sharedContext</var> and <var>context</var> should be used to aid in the summarization by providing context on how the web developer wishes the input to be summarized.</p>\n      <p>The summarization should conform to the guidance given by <var>type</var>, <var>format</var>, and <var>length</var>, in the definitions of each of their enumeration values.</p>\n      <p>If <var>outputLanguage</var> is non-null, the summarization should be in that language. Otherwise, it should be in the language of <var>input</var> (which might not match that of <var>context</var> or <var>sharedContext</var>). If <var>input</var> contains multiple languages, or the language of <var>input</var> cannot be detected, then either the output language is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②\">implementation-defined</a>, or the implementation may treat this as an error, per the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 3.5 Errors</a>.</p>"
        },
        {
          "html": "While true:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait for the next chunk of summarization data to be produced, for the summarization process to finish, or for the result of calling <var>stopProducing</var> to become true.</p>"
            },
            {
              "html": "If such a chunk is successfully produced:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let it be represented as a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤\">string</a> <var>chunk</var>.</p>"
                },
                {
                  "html": "<p>Perform <var>chunkProduced</var> given <var>chunk</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if the summarization process has finished:",
              "rationale": "perform",
              "steps": [
                {
                  "html": "<p>Perform <var>done</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, if <var>stopProducing</var> returns true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">break</a>.</p>"
            },
            {
              "html": "Otherwise, if an error occurred during summarization:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let the error be represented as <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarization-error-information\" id=\"ref-for-summarization-error-information③\">summarization error information</a> <var>errorInfo</var> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 3.5 Errors</a>.</p>"
                },
                {
                  "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break③\">Break</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "AISummarizer/destroy",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroy",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"AISummarizer\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"aisummarizer-destroy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">destroy</dfn> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer\" id=\"ref-for-aisummarizer①②\">AISummarizer</a></code> <var>summarizer</var>, given a JavaScript value <var>reason</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>summarizer</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destroyed\" id=\"ref-for-aisummarizer-destroyed⑧\">destroyed</a> to true.</p>"
        },
        {
          "html": "<p>Set <var>summarizer</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-destruction-reason\" id=\"ref-for-aisummarizer-destruction-reason⑧\">destruction reason</a> to <var>reason</var>.</p>"
        },
        {
          "html": "<p>The user agent should release any resources associated with <var>summarizer</var>, such as AI models loaded during <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarization-model\" id=\"ref-for-initialize-the-summarization-model②\">initialize the summarization model</a>, as long as those resources are not needed for other ongoing operations.</p>"
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype⑦\">AISummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 sentence.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 sentence.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 3 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 12 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype⑧\">AISummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 short paragraph.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 short paragraph.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 5 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 17 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype⑨\">AISummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 paragraph.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 paragraph.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 7 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 22 words.</p>"
            }
          ]
        }
      ]
    }
  ]
}